{% extends 'base.html' %}
{% block content %}
<div class="py-3 d-flex align-items-center justify-content-between flex-wrap gap-2">
  <h1 class="h3 mb-0">{{ tn('index.heading') }}</h1>
  <div class="d-flex gap-2">
    <form class="d-flex align-items-center gap-2" method="post" action="{{ url_for('load_json') }}?lang={{ lang }}" enctype="multipart/form-data">
      <input class="form-control form-control-sm" type="file" name="json_file" accept="application/json">
      <input type="hidden" name="lang" value="{{ lang }}">
      <button class="btn btn-outline-secondary btn-sm" type="submit">{{ tn('btn.load_json') }}</button>
    </form>
    {% if demos and demos|length > 0 %}
    <div class="dropdown">
      <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        {{ tn('btn.load_demo') }}
      </button>
      <ul class="dropdown-menu dropdown-menu-end">
        {% for d in demos %}
          <li><a class="dropdown-item" href="{{ url_for('load_json') }}?demo={{ d.name }}&lang={{ lang }}">{{ d.name }}</a></li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
  </div>
</div>
<form method="post" action="{{ url_for('analyze') }}">
  <input type="hidden" name="lang" value="{{ lang }}">
  <div class="row g-3">
    <div class="col-12 col-lg-6">
      <div class="card">
        <div class="card-header">{{ tn('section.patient_info') }}</div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="form-label">{{ tn('label.name') }}</label>
              <input type="text" class="form-control" name="name" placeholder="John Doe" value="{{ payload.name|default('') }}">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">{{ tn('label.age') }}</label>
              <input type="number" class="form-control" name="age" min="0" max="120" value="{{ payload.age|default('') }}">
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">{{ tn('label.sex') }}</label>
              <select class="form-select" name="sex">
                <option value="" {% if payload.sex=='' %}selected{% endif %}>{{ tn('select.placeholder') }}</option>
                <option value="Female" {% if payload.sex=='Female' %}selected{% endif %}>{{ tn('sex.female') }}</option>
                <option value="Male" {% if payload.sex=='Male' %}selected{% endif %}>{{ tn('sex.male') }}</option>
                <option value="Other" {% if payload.sex=='Other' %}selected{% endif %}>{{ tn('sex.other') }}</option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">{{ tn('label.chief_complaint') }}<span class="text-danger">*</span></label>
              <textarea class="form-control" name="chief_complaint" rows="2" placeholder="Main symptoms, onset, duration, aggravating/relieving factors">{{ payload.chief_complaint|default('') }}</textarea>
            </div>
            <div class="col-12">
              <label class="form-label">{{ tn('label.history') }}</label>
              <textarea class="form-control" name="history" rows="2" placeholder="Medical/surgical history, medications, allergies, imaging">{{ payload.history|default('') }}</textarea>
            </div>
            <div class="col-12">
              <label class="form-label">{{ tn('label.red_flags') }}</label>
              <textarea class="form-control" name="red_flags" rows="2" placeholder="If any red flags present, note and consider referral">{{ payload.red_flags|default('') }}</textarea>
            </div>
            <div class="col-12">
              <label class="form-label">{{ tn('label.vitals') }}</label>
              <textarea class="form-control" name="vitals" rows="2" placeholder="BP, HR, RR, SpO2, posture, gait, ROM, tenderness">{{ payload.vitals|default('') }}</textarea>
            </div>
            <div class="col-12">
              <label class="form-label">{{ tn('label.goals') }}</label>
              <textarea class="form-control" name="goals" rows="2" placeholder="Desired outcomes, functional goals">{{ payload.goals|default('') }}</textarea>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card">
        <div class="card-header">{{ tn('section.who_models') }}</div>
        <div class="card-body">
          <div class="mb-3">
            <label class="form-label">{{ tn('label.biomechanical') }}</label>
            <textarea class="form-control" name="biomechanical" rows="2" placeholder="Somatic dysfunctions, posture, fascial restrictions">{{ payload.biomechanical|default('') }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ tn('label.respiratory') }}</label>
            <textarea class="form-control" name="respiratory" rows="2" placeholder="Breathing pattern, rib motion, lymphatic/venous return">{{ payload.respiratory|default('') }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ tn('label.metabolic') }}</label>
            <textarea class="form-control" name="metabolic" rows="2" placeholder="Endocrine, inflammatory status, nutrition, sleep">{{ payload.metabolic|default('') }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ tn('label.neuro') }}</label>
            <textarea class="form-control" name="neurological" rows="2" placeholder="Autonomic balance, pain modulation, central/peripheral findings">{{ payload.neurological|default('') }}</textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">{{ tn('label.behavioral') }}</label>
            <textarea class="form-control" name="behavioral" rows="2" placeholder="Stress, coping, beliefs, social factors, work">{{ payload.behavioral|default('') }}</textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <button class="btn btn-primary btn-lg" type="submit">{{ tn('btn.generate') }}</button>
  </div>
</form>
{% endblock %}